FROM node:20.9

ARG port=8000

WORKDIR /app
ENV NODE_PORT NODE_PORT
ENV DB_PASSWORD DB_PASSWORD
ENV DB_HOST DB_HOST
ENV DB_PORT DB_PORT
ENV DB_USER DB_USER
ENV DB_NAME DB_NAME
ENV ACCESS_TOKEN_SECRET ACCESS_TOKEN_SECRET
ENV SALT_ROUNDS SALT_ROUNDS
ENV GOOGLE_CLIENT_ID GOOGLE_CLIENT_ID
ENV GOOGLE_CLIENT_SECRET GOOGLE_CLIENT_SECRET
ENV GOOGLE_OAUTH_REDIRECT_URL GOOGLE_OAUTH_REDIRECT_URL
ENV ORIGIN_URL ORIGIN_URL

COPY ./package.json .
RUN npm cache clean --force
RUN npm install
COPY . .
RUN npm run swagger
RUN npx tsc

EXPOSE ${port}

# CMD npm start
CMD node ./build/index.js
